var client = require("./_client-helper"),
    assert = require('assert');

describe('Authorization -', function() {

    it('should create an authorization successfully', function(done) {
        client.authorization.create({
            amount: "123123",
            description: "authorization description",
            card: {
                expMonth: "11",
                expYear: "19",
                cvc: "123",
                number: "5555555555554444"
            },
            currency: "USD"
        }, function(error, data) {

            if (error) {
                console.error(JSON.stringify(error.data));
                done(error);
            }

            assert.equal(data.paymentStatus, "APPROVED", "Create Authorization fails with correct error code.");
            done();
        });
    });

    it('should retrieve a list of authorizations successfully', function(done) {
        client.authorization.list({
            max: 30
        }, function(error, data) {

            if (error) {
                console.error(JSON.stringify(error.data));
                done(error);
            }

            assert.equal(data.max, 30, "List Authorization should succeed");
            done();
        });
    });

    it('should find an authorization successfully', function(done) {
        client.authorization.create({
            amount: "123123",
            description: "authorization description",
            card: {
                expMonth: "11",
                expYear: "19",
                cvc: "123",
                number: "5555555555554444"
            },
            currency: "USD"
        }, function(error, data) {

            if (error) {
                console.error(JSON.stringify(error.data));
                done(error);
            }

            // Use id of newly created authorization to execute 'find' request
            client.authorization.find(data.id, function(error, findData) {

                if (error) {
                    console.error(JSON.stringify(error.data));
                    done(error);
                }

                assert.equal(findData.id, data.id, "Find Authorization with ID '" + data.id + "' should succeed");
                done();
            });
        });
    });

});